import React from 'react'
import { Form, Row, Col, Select, DatePicker } from 'antd'
import moment from 'moment'
import PropTypes from 'prop-types'

// Helpers
import { localeVN, dateFormat } from 'src/helpers/FomatDateTime'

// Style Component
import { SystemAdvanceSearchWrapper } from '../styled/ReportsExploitationWrapper'

const { Option } = Select

function SystemAdvanceSearch({ handleChangeSearch, conditionSearch }) {
  const [form] = Form.useForm()

  const disabledStartDate = current => {
    return current && current > moment(form.getFieldValue('IssuedDateTo')).endOf('day')
  }

  const disabledEndDate = current => {
    return current && current < moment(form.getFieldValue('IssuedDateFrom')).endOf('day')
  }

  const handleChange = value => {
    const newCondition = {
      ...conditionSearch,
      DateType: value.DateType
    }
    if (value.DateType === 6 && value.FromDateInput !== '' && value.ToDateInput !== '') {
      newCondition.FromDateInput = moment(value.FromDateInput).format()
      newCondition.ToDateInput = moment(value.ToDateInput).format()
      handleChangeSearch(newCondition)
    }
    if (value.DateType !== 6) {
      handleChangeSearch({ DateType: value.DateType, FromDateInput: '', ToDateInput: '' })
    }
  }

  return (
    <SystemAdvanceSearchWrapper>
      <Form
        layout="vertical"
        initialValues={conditionSearch}
        form={form}
        labelAlign="left"
        onValuesChange={(changedValues, allValues) => handleChange(allValues)}
      >
        <Row justify="start" gutter="16">
          <Col span={4}>
            <Form.Item label="Khoảng thời gian" name="DateType">
              <Select style={{ width: '100%' }} getPopupContainer={trigger => trigger.parentNode}>
                <Option value={2}>Hôm nay</Option>
                <Option value={3}>Tuần này</Option>
                <Option value={4}>Tháng này</Option>
                <Option value={5}>Quý này</Option>
                <Option value={6}>Khoảng thời gian</Option>
                <Option value={7}>Năm nay</Option>
              </Select>
            </Form.Item>
          </Col>
          {form.getFieldValue('DateType') === 6 && (
            <>
              <Col span={4}>
                <Form.Item name="FromDateInput" label="Thời gian từ">
                  <DatePicker
                    getPopupContainer={trigger => trigger.parentNode}
                    style={{ width: '100%' }}
                    locale={localeVN}
                    format={dateFormat}
                    inputReadOnly
                    disabledDate={disabledStartDate}
                  />
                </Form.Item>
              </Col>

              <Col span={4}>
                <Form.Item name="ToDateInput" label="Thời gian đến">
                  <DatePicker
                    getPopupContainer={trigger => trigger.parentNode}
                    style={{ width: '100%' }}
                    locale={localeVN}
                    format={dateFormat}
                    inputReadOnly
                    disabledDate={disabledEndDate}
                  />
                </Form.Item>
              </Col>
            </>
          )}
        </Row>
      </Form>
    </SystemAdvanceSearchWrapper>
  )
}

SystemAdvanceSearch.propTypes = {
  handleChangeSearch: PropTypes.func,
  conditionSearch: PropTypes.object
}

export default SystemAdvanceSearch
